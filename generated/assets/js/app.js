!function(){"use strict";async function e(e,t,n){const o=await async function(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");const o=document.getElementById(e);o.width=t,o.height=n;const i=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}});return o.srcObject=i,new Promise(e=>{o.onloadedmetadata=()=>{e(o)}})}(e,t,n);return o.play(),o}function t(e,t,i,s,c,a=!1){t>=s.minPoseConfidence&&function(e,t,i,s,c,a=1){for(let d=0;d<e.length;d++){const r=e[d];if(r.score<t.minConfidence)continue;const{y:l,x:u}=r.position,f="";c?n(i,l*a,u*a,t.distanceDelta,s):o(i,l*a,u*a,3,s,f)}}(i,s,e,c,a)}function n(e,t,n,o,i){e.beginPath(),e.arc(n,t,o,0,2*Math.PI),e.setLineDash([5,5]),e.strokeStyle=i,e.stroke()}function o(e,t,n,o,i,s){e.beginPath(),e.arc(n,t,o,0,2*Math.PI),e.fillStyle=i,e.fillText(s,n+5,t),e.fill()}const i=document.getElementById("debugcanvas"),s=i.getContext("2d");let c=100;i.width=2*c,i.height=2*c;let a=0;const d=document.getElementById("msgbox"),r=document.getElementById("msg");function l(e){r.innerHTML=e,d.classList.remove("no-display")}function u(e,t,n,o,i){let s=f(t,e,o),c=f(n,e,o);if(void 0!==s&&void 0!==c){if(Math.abs(s.position.x-c.position.x)>=i)return!1;if(Math.abs(s.position.y-c.position.y)>=i)return!1}return!0}function f(e,t,n){return e.keypoints.find(({part:e,score:o})=>e===t&&o>=n)}const h="nose",y="leftEye",g="rightEye",m="leftEar",v="rightEar",p="leftShoulder",C="rightShoulder";let P={debugMode:!0,saveNextPose:!1,playSound:!0,correctPose:void 0,detectionDelayMs:2e3,historySize:10,distanceDelta:15,minPoseConfidence:.3,minPartConfidence:.6,videoWidth:800,videoHeight:650};const w={architecture:"MobileNetV1",outputStride:16,inputResolution:513,multiplier:.75};window.config=P;const E=new Audio("assets/beep-07.mp3");let M=[];function b(){P.saveNextPose=!0,d.classList.add("no-display")}function I(){let e=document.getElementById("mute");P.playSound?(P.playSound=!1,e.innerHTML="ðŸ”‡"):(P.playSound=!0,e.innerHTML="ðŸ”‰")}!async function(){let n,o;try{n=await e("video",P.videoWidth,P.videoHeight)}catch(e){throw l("Couldn't load video, please try a different browser"),e}try{o=await posenet.load(w)}catch(e){throw l("Couldn't load posenet, please try refreshing the page"),e}!function(e,n){const o=document.getElementById("output"),i=o.getContext("2d");o.width=P.videoWidth,o.height=P.videoHeight,async function o(){const d=await n.estimatePoses(e,{flipHorizontal:!0,decodingMethod:"single-person"}),r=d[0];if(P.saveNextPose&&r.score>=P.minPoseConfidence&&(P.correctPose=r,P.saveNextPose=!1),void 0===P.correctPose)requestAnimationFrame(o);else{let e;e=r.score>=P.minPoseConfidence?function(e,t,n,o){return u(h,e,t,n,o)&&u(y,e,t,n,o)&&u(g,e,t,n,o)&&u(m,e,t,n,o)&&u(v,e,t,n,o)&&u(p,e,t,n,o)&&u(C,e,t,n,o)}(r,P.correctPose,P.minPartConfidence,P.distanceDelta)?"CORRECT":"INCORRECT":"NOPOSE",M.push(e),M.length>P.historySize&&M.shift();let t=M.every(e=>"INCORRECT"==e);P.playSound&&t&&E.play(),setTimeout((function(){requestAnimationFrame(o)}),P.detectionDelayMs)}P.debugMode&&(function(e,n,o){let i=o.videoWidth,s=o.videoHeight,c=o.correctPose;e.clearRect(0,0,i,s),n.forEach(({score:n,keypoints:i})=>t(e,n,i,o,"#ff2626")),void 0!==c&&t(e,c.score,c.keypoints,o,"#26ff26",!0)}(i,d,P),function(e,t){if(0!=e.length){let n=2*Math.PI/t,o=e[e.length-1];s.beginPath(),s.moveTo(c,c),s.fillStyle="CORRECT"==o?"green":"INCORRECT"==o?"red":"yellow",s.arc(c,c,c,a*n,(a+1)*n),s.fill(),a=(a+1)%t}}(M,P.historySize))}()}(n,o)}(),document.getElementById("calibrate").onclick=function(){b()},document.getElementById("mute").onclick=function(){I()},document.onkeypress=function(e){77==(e=e||window.event).keyCode||109==e.keyCode?I():67!=e.keyCode&&99!=e.keyCode||b()}}();