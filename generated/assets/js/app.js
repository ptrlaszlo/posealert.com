!function(){"use strict";async function e(e,t,o){const n=await async function(e,t,o){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");const n=document.getElementById(e);n.width=t,n.height=o;const i=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}});return n.srcObject=i,new Promise(e=>{n.onloadedmetadata=()=>{e(n)}})}(e,t,o);return n.play(),n}function t(e,t,i,c,s,a=!1){t>=c.minPoseConfidence&&function(e,t,i,c,s,a=1){for(let d=0;d<e.length;d++){const r=e[d];if(r.score<t.minConfidence)continue;const{y:u,x:l}=r.position,f="";s?o(i,u*a,l*a,t.distanceDelta,c):n(i,u*a,l*a,3,c,f)}}(i,c,e,s,a)}function o(e,t,o,n,i){e.beginPath(),e.arc(o,t,n,0,2*Math.PI),e.setLineDash([5,5]),e.strokeStyle=i,e.stroke()}function n(e,t,o,n,i,c){e.beginPath(),e.arc(o,t,n,0,2*Math.PI),e.fillStyle=i,e.fillText(c,o+5,t),e.fill()}const i=document.getElementById("msgbox"),c=document.getElementById("msg");function s(e){c.innerHTML=e,i.classList.remove("no-display")}function a(e,t,o,n,i){let c=d(t,e,n),s=d(o,e,n);if(void 0!==c&&void 0!==s){if(Math.abs(c.position.x-s.position.x)>=i)return!1;if(Math.abs(c.position.y-s.position.y)>=i)return!1}return!0}function d(e,t,o){return e.keypoints.find(({part:e,score:n})=>e===t&&n>=o)}const r="nose",u="leftEye",l="rightEye",f="leftEar",m="rightEar",y="leftShoulder",g="rightShoulder";let h={debugMode:!0,saveNextPose:!1,playSound:!0,correctPose:void 0,distanceDelta:15,minPoseConfidence:.3,minPartConfidence:.6,videoWidth:800,videoHeight:650};const p={architecture:"MobileNetV1",outputStride:16,inputResolution:513,multiplier:.75},v=new Audio("assets/beep-07.mp3");function P(){h.saveNextPose=!0,i.classList.add("no-display")}function w(){let e=document.getElementById("mute");h.playSound?(h.playSound=!1,e.innerHTML="ðŸ”‡"):(h.playSound=!0,e.innerHTML="ðŸ”‰")}window.config=h,async function(){let o,n;try{o=await e("video",h.videoWidth,h.videoHeight)}catch(e){throw s("Couldn't load video, please try a different browser"),e}try{n=await posenet.load(p)}catch(e){throw s("Couldn't load posenet, please try refreshing the page"),e}!function(e,o){const n=document.getElementById("output"),i=n.getContext("2d");n.width=h.videoWidth,n.height=h.videoHeight,async function n(){const c=await o.estimatePoses(e,{flipHorizontal:!0,decodingMethod:"single-person"}),s=c[0];h.saveNextPose&&s.score>=h.minPoseConfidence&&(h.correctPose=s,h.saveNextPose=!1),h.debugMode&&function(e,o,n){let i=n.videoWidth,c=n.videoHeight,s=n.correctPose;e.clearRect(0,0,i,c),o.forEach(({score:o,keypoints:i})=>t(e,o,i,n,"#ff2626")),void 0!==s&&t(e,s.score,s.keypoints,n,"#26ff26",!0)}(i,c,h),void 0===h.correctPose?requestAnimationFrame(n):(s.score>=h.minPoseConfidence&&(function(e,t,o,n){return a(r,e,t,o,n)&&a(u,e,t,o,n)&&a(l,e,t,o,n)&&a(f,e,t,o,n)&&a(m,e,t,o,n)&&a(y,e,t,o,n)&&a(g,e,t,o,n)}(s,h.correctPose,h.minPartConfidence,h.distanceDelta)||h.playSound&&v.play()),setTimeout((function(){requestAnimationFrame(n)}),2e3))}()}(o,n)}(),document.getElementById("calibrate").onclick=function(){P()},document.getElementById("mute").onclick=function(){w()},document.onkeypress=function(e){77==(e=e||window.event).keyCode||109==e.keyCode?w():67!=e.keyCode&&99!=e.keyCode||P()}}();