!function(){"use strict";async function e(e,t,o){const i=await async function(e,t,o){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");const i=document.getElementById(e);i.width=t,i.height=o;const n=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}});return i.srcObject=n,new Promise(e=>{i.onloadedmetadata=()=>{e(i)}})}(e,t,o);return i.play(),i}function t(e,t,n,a,c,r=!1){t>=a.minPoseConfidence&&function(e,t,n,a,c,r,s=1){for(let d=0;d<e.length;d++){const l=e[d];if(l.score<t)continue;const{y:u,x:f}=l.position;l.part,l.score.toFixed(4),f.toFixed(2),u.toFixed(2);c?o(n,u*s,f*s,r,a):i(n,u*s,f*s,3,a)}}(n,a.minPartConfidence,e,c,r,a.distanceDelta)}function o(e,t,o,i,n){e.globalAlpha=.2,e.beginPath(),e.arc(o,t,i,0,2*Math.PI),e.fillStyle=n,e.fill()}function i(e,t,o,i,n,a){e.globalAlpha=1,e.beginPath(),e.arc(o,t,i,0,2*Math.PI),e.fillStyle=n,e.fill()}const n=document.getElementById("msgbox"),a=document.getElementById("msg");function c(e){a.innerHTML=e,n.classList.remove("no-display")}function r(e,t,o,i,n){let a=s(t,e,i),c=s(o,e,i);if(void 0!==a&&void 0!==c){if(Math.abs(a.position.x-c.position.x)>=n)return!1;if(Math.abs(a.position.y-c.position.y)>=n)return!1}return!0}function s(e,t,o){return e.keypoints.find(({part:e,score:i})=>e===t&&i>=o)}const d="nose",l="leftEye",u="rightEye",f="leftEar",g="rightEar",h="leftShoulder",m="rightShoulder";let v={debugMode:!0,saveNextPose:!1,correctPose:void 0,distanceDelta:15,minPoseConfidence:.3,minPartConfidence:.6,videoWidth:800,videoHeight:650};const y={architecture:"MobileNetV1",outputStride:16,inputResolution:513,multiplier:.75};!async function(){let o,i;try{o=await e("video",v.videoWidth,v.videoHeight)}catch(e){throw c("Couldn't load video, please try a different browser"),e}document.getElementById("whycamera").classList.add("no-display");try{i=await posenet.load(y)}catch(e){throw c("Couldn't load posenet, please try refreshing the page"),e}!function(e,o){const i=document.getElementById("output"),n=i.getContext("2d");i.width=v.videoWidth,i.height=v.videoHeight,async function i(){const a=await o.estimatePoses(e,{flipHorizontal:!0,decodingMethod:"single-person"}),c=a[0];if(v.saveNextPose&&c.score>=v.minPoseConfidence&&(v.correctPose=c,v.saveNextPose=!1),v.debugMode&&function(e,o,i){let n=i.videoWidth,a=i.videoHeight,c=i.correctPose;e.clearRect(0,0,n,a),o.forEach(({score:o,keypoints:n})=>t(e,o,n,i,"#ff2626")),void 0!==c&&t(e,c.score,c.keypoints,i,"#26ff26",!0)}(n,a,v),void 0===v.correctPose)requestAnimationFrame(i);else{if(c.score>=v.minPoseConfidence){const e=function(e,t,o,i){return r(d,e,t,o,i)&&r(l,e,t,o,i)&&r(u,e,t,o,i)&&r(f,e,t,o,i)&&r(g,e,t,o,i)&&r(h,e,t,o,i)&&r(m,e,t,o,i)}(c,v.correctPose,v.minPartConfidence,v.distanceDelta);document.getElementById("calibrate").style.backgroundColor=e?"green":"red"}setTimeout((function(){requestAnimationFrame(i)}),2e3)}}()}(o,i)}(),document.getElementById("calibrate").onclick=function(){v.saveNextPose=!0}}();