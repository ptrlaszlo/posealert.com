!function(){"use strict";async function e(e,t,o){const i=await async function(e,t,o){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");const i=document.getElementById(e);i.width=t,i.height=o;const n=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}});return i.srcObject=n,new Promise(e=>{i.onloadedmetadata=()=>{e(i)}})}(e,t,o);return i.play(),i}function t(e,t,n,s,a,c=!1){t>=s.minPoseConfidence&&function(e,t,n,s,a,c=1){for(let r=0;r<e.length;r++){const d=e[r];if(d.score<t.minConfidence)continue;const{y:l,x:u}=d.position,f="";a?o(n,l*c,u*c,t.distanceDelta,s):i(n,l*c,u*c,3,s,f)}}(n,s,e,a,c)}function o(e,t,o,i,n){e.beginPath(),e.arc(o,t,i,0,2*Math.PI),e.setLineDash([5,5]),e.strokeStyle=n,e.stroke()}function i(e,t,o,i,n,s){e.beginPath(),e.arc(o,t,i,0,2*Math.PI),e.fillStyle=n,e.fillText(s,o+5,t),e.fill()}const n=document.getElementById("msgbox"),s=document.getElementById("msg");function a(e){s.innerHTML=e,n.classList.remove("no-display")}function c(e,t,o,i,n){let s=r(t,e,i),a=r(o,e,i);if(void 0!==s&&void 0!==a){if(Math.abs(s.position.x-a.position.x)>=n)return!1;if(Math.abs(s.position.y-a.position.y)>=n)return!1}return!0}function r(e,t,o){return e.keypoints.find(({part:e,score:i})=>e===t&&i>=o)}const d="nose",l="leftEye",u="rightEye",f="leftEar",h="rightEar",g="leftShoulder",m="rightShoulder";let v={debugMode:!0,saveNextPose:!1,correctPose:void 0,distanceDelta:15,minPoseConfidence:.3,minPartConfidence:.6,videoWidth:800,videoHeight:650};const y={architecture:"MobileNetV1",outputStride:16,inputResolution:513,multiplier:.75},p=new Audio("assets/beep-07.mp3");window.config=v,async function(){let o,i;try{o=await e("video",v.videoWidth,v.videoHeight)}catch(e){throw a("Couldn't load video, please try a different browser"),e}try{i=await posenet.load(y)}catch(e){throw a("Couldn't load posenet, please try refreshing the page"),e}!function(e,o){const i=document.getElementById("output"),n=i.getContext("2d");i.width=v.videoWidth,i.height=v.videoHeight,async function i(){const s=await o.estimatePoses(e,{flipHorizontal:!0,decodingMethod:"single-person"}),a=s[0];v.saveNextPose&&a.score>=v.minPoseConfidence&&(v.correctPose=a,v.saveNextPose=!1),v.debugMode&&function(e,o,i){let n=i.videoWidth,s=i.videoHeight,a=i.correctPose;e.clearRect(0,0,n,s),o.forEach(({score:o,keypoints:n})=>t(e,o,n,i,"#ff2626")),void 0!==a&&t(e,a.score,a.keypoints,i,"#26ff26",!0)}(n,s,v),void 0===v.correctPose?requestAnimationFrame(i):(a.score>=v.minPoseConfidence&&(function(e,t,o,i){return c(d,e,t,o,i)&&c(l,e,t,o,i)&&c(u,e,t,o,i)&&c(f,e,t,o,i)&&c(h,e,t,o,i)&&c(g,e,t,o,i)&&c(m,e,t,o,i)}(a,v.correctPose,v.minPartConfidence,v.distanceDelta)||p.play()),setTimeout((function(){requestAnimationFrame(i)}),2e3))}()}(o,i)}(),document.getElementById("calibrate").onclick=function(){v.saveNextPose=!0,n.classList.add("no-display")}}();